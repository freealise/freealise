<html>

<head>
  <meta charset="utf-8" />
  <style>
    #result {
      font-size: 14px;
      font-family: monospace;
      width:99vw;
    }

    a {
      color: steelblue;
    }
    
    b {
        font-weight: normal;
    }
  </style>
</head>
<script src="https://unpkg.com/compromise"></script>
<script src="../notes.js"></script>
<!-- <script src="../plugins/speech/builds/compromise-speech.cjs"></script> -->
<script src="https://unpkg.com/compromise-stats"></script>
<script defer>
  // compromise is loaded as 'window.nlp'
  // plugin is loaded as 'window.compromiseStats'
  
try {
    
  const mapping = {
    CC: 'Conjunction',
    CD: 'Cardinal',
    DT: 'Determiner',
    EX: 'Preposition', //Existential there
    FW: 'Expression',
    IN: 'Preposition',
    JJ: 'Adjective',
    JJR: 'Comparative',
    JJS: 'Superlative',
    MD: 'Modal',
    NN: 'Noun',
    NNS: 'Plural',
    NNP: 'Singular',
    NNPS: 'Plural',
    POS: 'Possessive',
    PRP: 'Pronoun',
    RB: 'Adverb',
    RBR: 'Comparative',
    RBS: 'Superlative',
    RP: 'PhrasalVerb',
    PDT: 'Determiner',
    SYM: 'Expression',
    TO: 'Conjunction',
    UH: 'Expression',
    VB: 'Verb',
    VBD: 'PastTense',
    VBG: 'Gerund',
    VBN: 'Participle', // past participle
    VBP: 'PresentTense', // non-3rd person singular present
    VBZ: 'PresentTense', // 3rd person singular present
    'PRP$': 'Pronoun',
    'WP$': 'Possessive',
    WDT: 'Determiner',
    WP: 'Pronoun',
    WRB: 'Adverb',
  };
  
  const colors = {
    CC: '33',
    CD: '50',
    DT: '33',
    EX: '33', //Existential there
    FW: '33',
    IN: '33',
    JJ: '50',
    JJR: '50',
    JJS: '50',
    MD: '33',
    NN: '100',
    NNS: '100',
    NNP: '100',
    NNPS: '100',
    POS: '33',
    PRP: '33',
    RB: '33',
    RBR: '33',
    RBS: '33',
    RP: '67',
    PDT: '33',
    SYM: '33',
    TO: '33',
    UH: '33',
    VB: '67',
    VBD: '67',
    VBG: '67',
    VBN: '67', // past participle
    VBP: '67', // non-3rd person singular present
    VBZ: '67', // 3rd person singular present
    'PRP$': '33',
    'WP$': '33',
    WDT: '33',
    WP: '33',
    WRB: '33',
  };
  
  nlp.plugin(compromiseStats);
    
  txt = txt.replace(/\</g,'&lt;').replace(/\>/g,'&gt;');
  var doc = nlp(txt);
  //doc.compute('syllables')
  doc.compute('penn');
  
  //doc.tfidf();
  //let model = doc;
  var tfidf = doc.compute('tfidf').json();
  //document.write(JSON.stringify(tfidf));
  
  //nlp.plugin(compromiseWikipedia);
  //var wiki = doc.wikipedia().json();

  window.onload = function () {
    //let out = "";
    //let arr = wiki.map(t=>t.text);
    
    for (var j=0; j<doc.json().length; j++) {
      let arr = doc.json()[j].terms.map(t=>[t.text, t.penn, t.tfidf]); //doc.syllables()
    
      for (var i=0; i<arr.length; i++) {
        /*if (arr[i] && arr[i]!='') {
          var p = txt.indexOf(arr[i]);
          txt = txt.substr(0, p) + "<b>"+arr[i].toUpperCase()+"</b>" + txt.substr(p+arr[i].length);
        }*/
        if (colors[arr[i][1]]) {
          arr[i][1] = colors[arr[i][1]];
        } else {
          arr[i][1] = '50';
        }
        if (arr[i][0]!='' && arr[i][0].length>1 && arr[i][0].search(/\d/)==-1) {
          var p = txt.indexOf(arr[i][0]);
          //document.write(p+' ');
          var b = txt.substr(0,p);
          var d = txt.substr(p+arr[i][0].length);
          txt = b + "<B STYLE=\"COLOR:HSLA(0,0%,"+(100-arr[i][1])+"%,"+(0.5/arr[i][2]+0.5)+");\">" + arr[i][0].split("").join("â€‹") + "</B>" + d;
        }
      }
      //out += "\n";
    }
    let el = document.getElementById('result');
    txt = txt.replace(/\s/g,'&nbsp;').replace(/\n/g,'<br/>');
    el.innerHTML = txt; //JSON.stringify(wiki, null, 2); //out;
  }
} catch(e) {alert(e);}
</script>

<body>
  <div>compromise plugin demo</div>
  <div><a href="https://github.com/spencermountain/compromise/blob/master/demo/plugin.html">view source</a></div>
  <div id="result"></div>
</body>

</html>