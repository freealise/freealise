<html>

<head>
  <meta charset="utf-8" />
  <style>
    #result {
      font-size: 14px;
      font-family: monospace;
      color: #c0c0c0;
      width:99vw;
      white-space: pre-wrap;
      word-break: normal;
      overflow-wrap: break-word;
    }

    a {
      color: steelblue;
    }
    
    u {
      text-decoration: none;
    }
    
    .b {
      text-shadow: 0 0 0.5px black;
    }
    
    .bold {
      text-shadow: 0 0 0.5px black, 0 0 0.5px black; 
    }
    
    .bolder {
      text-shadow: 0 0 0.5px black, 0 0 0.5px black, 0 0 0.5px black; 
    }
    
    .boldest {
      text-shadow: 0 0 0.5px black, 0 0 0.5px black, 0 0 0.5px black, 0 0 0.5px black; 
    }
    
    .theboldest {
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div>compromise plugin demo</div>
  <div><a href="https://github.com/spencermountain/compromise/blob/master/demo/plugin.html">view source</a></div>
  <input type="file" id="fileElem" accept="*/*" style="display:none" />
  <button id="fileSelect">Upload</button><span id="fileList"></span>
  <div id="result"></div>
  
<script src="https://unpkg.com/compromise"></script>
<script src="../notes.js"></script>
<!-- <script src="../plugins/speech/builds/compromise-speech.cjs"></script> -->
<script src="./compromise-stats-0.1.1.min.js"></script>
<script>

const fileSelect = document.getElementById("fileSelect"),
fileElem = document.getElementById("fileElem"),
fileList = document.getElementById("fileList");

fileSelect.addEventListener(
  "click",
  (e) => {
    if (fileElem) {
      fileElem.click();
    }
  },
  false,
);
fileElem.addEventListener("change", handleFiles);

function handleFiles(e) {
  fileList.textContent = "";
  if (!e.target.files.length) {
    fileList.textContent = "No file selected!";
  } else {
    var reader  = new FileReader();
  
    reader.addEventListener("load", function () {
      txt = reader.result;
      alert('ok '+e.target.files[0].name);
      try{loadFile(txt, colors);}catch(e){alert(e);}
      e.target.value = null;
    }, false);
  
    reader.readAsText(e.target.files[0]);
  }
}

  // compromise is loaded as 'window.nlp'
  // plugin is loaded as 'window.compromiseStats'
    
  const mapping = {
    CC: 'Conjunction',
    CD: 'Cardinal',
    DT: 'Determiner',
    EX: 'Preposition', //Existential there
    FW: 'Expression',
    IN: 'Preposition',
    JJ: 'Adjective',
    JJR: 'Comparative',
    JJS: 'Superlative',
    MD: 'Modal',
    NN: 'Noun',
    NNS: 'Plural',
    NNP: 'Singular',
    NNPS: 'Plural',
    POS: 'Possessive',
    PRP: 'Pronoun',
    RB: 'Adverb',
    RBR: 'Comparative',
    RBS: 'Superlative',
    RP: 'PhrasalVerb',
    PDT: 'Determiner',
    SYM: 'Expression',
    TO: 'Conjunction',
    UH: 'Expression',
    VB: 'Verb',
    VBD: 'PastTense',
    VBG: 'Gerund',
    VBN: 'Participle', // past participle
    VBP: 'PresentTense', // non-3rd person singular present
    VBZ: 'PresentTense', // 3rd person singular present
    'PRP$': 'Pronoun',
    'WP$': 'Possessive',
    WDT: 'Determiner',
    WP: 'Pronoun',
    WRB: 'Adverb',
  };
  
  const colors = {
    CC: '33',
    CD: '50',
    DT: '33',
    EX: '33', //Existential there
    FW: '33',
    IN: '33',
    JJ: '50',
    JJR: '50',
    JJS: '50',
    MD: '33',
    NN: '100',
    NNS: '100',
    NNP: '100',
    NNPS: '100',
    POS: '33',
    PRP: '33',
    RB: '33',
    RBR: '33',
    RBS: '33',
    RP: '67',
    PDT: '33',
    SYM: '33',
    TO: '33',
    UH: '33',
    VB: '67',
    VBD: '67',
    VBG: '67',
    VBN: '67', // past participle
    VBP: '67', // non-3rd person singular present
    VBZ: '67', // 3rd person singular present
    'PRP$': '33',
    'WP$': '33',
    WDT: '33',
    WP: '33',
    WRB: '33',
  };
  
  nlp.plugin(compromiseStats);
  
  var list = ["a","abbreviation","ability","able","about","above","abroad","absence","absent","accept","acceptable","accident","accidental","accordance","according to","account","ache","achieve","achievement","acid","across","act","action","active","activity","actor","actress","actual","actually","add","addition","additional","address","adjective","admiration","admire","admit","admittance","adult","advance","advanced","advantage","adventure","adverb","advertise","advertisement","advice","advise","affair","affect","afford","afraid","after","afternoon","afterwards","again","against","age","ago","agree","agreement","ahead","aim","air","aircraft","airport","alcohol","alike","alive","all","allow","almost","alone","along","aloud","alphabet","already","also","although","altogether","always","am","are","among","amount","amuse","amusement","amusing","an","ancient","and","anger","angle","angry","animal","ankle","announce","annoy","annoyance","annoying","another","answer","ant","anxiety","anxious","any","anybody","anyhow","anyone","anything","anywhere","apart","apartment","apparatus","appear","appearance","apple","appoint","approval","approve","arch","area","argue","argument","arm","armour","armor","arms","army","around","arrange","arrangement","arrival","arrive","art","article","artificial","as","as opposed to","ash","ashamed","aside","ask","asleep","association","at","ate","atom","attack","attempt","attend","attendance","attention","attitude","attract","attractive","aunt","authority","autumn","available","average","avoid","awake","away","awkward","baby","back","background","backward","backwards","bacteria","bad","bag","bake","balance","ball","banana","band","bank","bar","bare","barrel","base","basic","basket","bath","bathe","battle","be","am","are","is","being","was","were","been","beach","beak","beam","bean","bear","bore","borne","beard","beat","beaten","beautiful","beauty","because","become","became","bed","bee","beer","before","beg","begin","began","begun","beginning","behave","behaviour","behavior","behind","belief","believe","bell","belong","below","belt","bend","bent","beneath","berry","beside","besides","best","better","between","beyond","bicycle","big","bill","bind","bound","bird","birth","birthday","bit","bite","bit","bitten","bitter","black","blade","blame","bleed","bled","bless","blind","block","blood","blow","blew","blue","board","boat","body","boil","bomb","bone","book","boot","border","bored","boring","born","borrow","both","bottle","bottom","bowels","bowl","box","boy","brain","branch","brass","brave","bread","breadth","break","broke","broken","breakfast","breast","breath","breathe","breed","bred","brick","bridge","bright","bring","brought","broad","broadcast","brother","brown","brush","bucket","build","built","building","bullet","bunch","burial","burn","burnt","burst","bury","bus","bush","business","busy","but","butter","button","buy","bought","by","cage","cake","calculate","calculator","call","calm","camera","camp","can","could","candle","cannot","cap","capital","captain","car","card","cardboard","care","careful","carefully","careless","carriage","carry","cart","case","castle","cat","catch","caught","cattle","cause","ceiling","celebrate","cell","cement","cent","centimetre","centimeter","central","centre","center","century","ceremony","certain","chain","chair","chairperson","chalk","chance","change","character","charge","charm","chase","cheap","cheat","check","cheek","cheer","cheerful","cheese","chemical","chemistry","cheque","check","chest","chicken","chief","child","children","childhood","chimney","chin","chocolate","choice","choose","chose","chosen","church","cigarette","cinema","circle","circular","citizen","city","civilization","claim","class","clay","clean","clear","clerk","clever","cliff","climb","clock","clockwork","close","cloth","clothes","clothing","cloud","club","coal","coast","coat","coffee","coin","cold","collar","collect","college","colour","color","comb","combination","combine","come","came","comfort","comfortable","command","committee","common","communicate","communication","companion","company","compare","comparison","compete","competition","competitor","complain","complaint","complete","completely","complicated","compound","computer","concern","concerning","concert","condition","confidence","confident","confuse","confusing","connect","connection","conscience","conscious","consider","consist","consist of","consonant","contain","container","contents","continue","continuous","contract","control","convenient","conversation","cook","cool","copper","copy","cord","corn","corner","correct","cost","cotton","cough","could","council","count","country","countryside","courage","course","court","cover","cow","coward","cowardly","crack","crash","crazy","cream","creature","creep","crept","cricket","crime","criminal","criticism","criticize","crop","cross","crowd","cruel","cruelty","crush","cry","cries","cried","cultivate","cup","cupboard","cure","curl","current","curse","curtain","curve","custom","customer","cut","cycle","daily","damage","dance","danger","dangerous","dare","daring","dark","date","daughter","day","dead","deal","deal with","dealt with","dear","death","debt","decay","deceit","deceive","decide","decimal","decision","declaration","declare","decorate","decoration","decrease","deep","deer","defeat","defence","defense","defend","definite","definitely","degree","delay","deliberate","deliberately","delicate","delight","deliver","demand","department","depend","dependent","depth","descend","describe","description","descriptive","desert","deserve","design","desirable","desire","desk","destroy","destruction","detail","determination","determined","develop","devil","diamond","dictionary","die","dying","difference","different","difficult","difficulty","dig","dug","dinner","dip","direct","direction","dirt","dirty","dis-","disappoint","disappointing","discourage","discouragement","discover","discovery","discuss","discussion","disease","dish","dismiss","distance","distant","ditch","divide","division","do","does","doing","did","done","doctor","document","dog","dollar","door","doorway","dot","double","doubt","down","drag","draw","drew","drawn","drawer","dream","dreamt","dress","drink","drank","drunk","drive","drove","driven","drop","drown","drug","drum","drunk","dry","dries","dried","duck","dull","during","dust","duty","each","eager","ear","early","earn","earth","east","eastern","easy","easily","eat","ate","eaten","economic","edge","educate","educated","education","effect","effective","effort","egg","eight","eighth","either","elastic","elbow","elect","election","electric","electricity","electronic","elephant","else","embarrass","embarrassing","emotion","emphasize","employ","employer","employment","empty","enclose","enclosure","encourage","encouragement","end","enemy","energy","engine","engineer","english","enjoy","enjoyable","enjoyment","enough","enter","entertain","entertainment","entrance","envelope","environment","equal","equality","equipment","escape","especially","establish","establishment","even","evening","event","ever","every","everybody","everyone","everything","everywhere","evil","exact","exactly","examination","examine","example","excellent","except","exchange","excite","excited","exciting","excuse","exercise","exist","existence","expect","expensive","experience","explain","explanation","explode","explosion","explosive","express","expression","extreme","extremely","eye","eyelid","face","fact","factory","fail","failure","faint","fair","fairly","fairy","faith","faithful","fall","fell","fallen","false","fame","familiar","family","famous","fancy","far","farm","farmer","farmyard","fashion","fashionable","fast","fasten","fat","fate","father","fault","favour","favor","favourable","favorable","favourite","favorite","fear","feather","feature","feed","fed","feel","felt","feeling","feelings","fellow","female","fence","fever","few","field","fierce","fifth","fight","fought","figure","fill","film","final","finally","financial","find","found","find out","found out","fine","finger","finish","fire","fireplace","firm","first","fish","fisherman","fishermen","fit","five","fix","flag","flame","flash","flat","flesh","flight","float","flood","floor","flour","flow","flower","fly","flies","flew","flown","fold","follow","fond","food","fool","foolish","foot","feet","football","footpath","footstep","for","forbid","forbade","forbidden","force","forehead","foreign","foreigner","forest","forget","forgot","forgotten","forgive","forgave","forgiven","fork","form","formal","former","formerly","fort","fortunate","fortune","forward","forwards","four","fourth","fox","frame","free","freedom","freeze","froze","frozen","frequent","fresh","friend","friendly","frighten","frightening","from","front","fruit","fulfil","fulfill","full","fun","funeral","funny","fur","furnish","furniture","further","future","gain","game","garage","garden","garment","gas","gate","gather","general","generally","generous","gentle","gentleman","gentlemen","get","got","gotten","gift","girl","give","gave","given","glad","glass","glory","glue","go","goes","going","went","gone","goat","god","gold","golden","good","goodbye","goods","govern","government","grace","graceful","gradual","grain","gram","grammar","grand","grandfather","grandmother","grandparent","grass","grateful","grave","great","green","greet","greeting","grey","gray","grief","grieve","ground","group","grow","grew","grown","growth","guard","guess","guest","guidance","guide","guilt","guilty","gun","habit","habitual","hair","hairy","half","halves","hall","hammer","hand","handkerchief","handle","hang","hung","hanged","happen","happy","hard","harden","hardly","hardship","harm","harmful","harmless","hasty","hat","hate","hatred","have","has","had","he","head","health","healthy","hear","heard","heart","heat","heaven","heavy","heel","height","hello","help","helpful","hen","her","here","hers","herself","hide","hid","hidden","high","hill","him","himself","hire","his","historical","history","hit","hold","held","hole","holiday","hollow","holy","home","honest","honesty","honour","honor","honourable","honorable","hook","hope","hopeful","hopeless","horizon","horn","horse","hospital","host","hot","hotel","hour","hourly","house","how","human","humorous","humour","humor","hundred","hundredth","hunger","hungry","hunt","hurry","hurt","husband","hut","i","ice","icy","idea","if","ignore","ill","illegal","illness","im-","image","imaginary","imagination","imagine","immediately","importance","important","impressive","improve","improvement","in","in-","in spite of","include","including","income","increase","independent","indoor","indoors","industrial","industry","infect","infection","infectious","influence","influential","inform","information","injure","injury","ink","inner","inquire","inquiry","insect","inside","instead","institution","instruct","instruction","instrument","insult","insulting","insurance","insure","intelligence","intelligent","intend","intention","interest","interesting","international","interrupt","into","introduce","introduction","invent","invention","invitation","invite","involve","inwards","ir-","iron","is","island","it","its","itself","jaw","jealous","jealousy","jelly","jewel","jewellery","jewelry","job","join","joint","joke","journey","joy","judge","judgment","juice","jump","just","justice","keen","keep","kept","key","kick","kill","kilo","kilogram","kilometre","kilometer","kind","king","kingdom","kiss","kitchen","knee","kneel","knelt","knife","knock","knot","know","knew","known","knowledge","labour","labor","lack","ladder","lady","lake","lamb","lamp","land","language","large","last","late","lately","laugh","laughter","law","lawyer","lay","laid","layer","lazy","lead","led","leaf","leaves","lean","learn","learnt","least","leather","leave","left","left","leg","legal","lend","lent","length","less","lesson","let","let go of","letter","level","library","lid","lie","lying","lied","lay","lain","lie down","lying down","lay down","lain down","life","lives","lift","light","lit","lightning","like","likely","limb","limit","line","lion","lip","liquid","list","listen","literature","litre","liter","little","live","load","loaf","loaves","local","lock","lodging","lodgings","log","lonely","long","look","look after","look for","look up","loose","lord","lose","lost","loss","lot","loud","love","low","lower","loyal","loyalty","luck","lucky","lump","lung","machine","machinery","mad","magazine","magic","magician","mail","main","make","made","make into","made into","make up","made up","male","man","men","manage","manager","manner","many","map","march","mark","market","marriage","married","marry","mass","master","mat","match","material","mathematics","matter","may","maybe","me","meal","mean","meant","meaning","means","measure","measurement","meat","medical","medicine","meet","met","meeting","melt","member","memory","mend","mental","mention","merry","message","messenger","metal","method","metre","meter","metric","microscope","middle","might","mile","military","milk","million","millionth","mind","mine","mineral","minister","minute","mirror","miss","mist","mistake","mix","mixture","model","modern","moment","money","monkey","month","monthly","moon","moral","morals","more","morning","most","mother","motor","mountain","mouse","mice","mouth","move","movement","much","mud","multiply","murder","muscle","music","musician","must","my","myself","mysterious","mystery","nail","name","narrow","nasty","nation","national","natural","nature","naval","navy","near","nearly","neat","necessary","neck","need","needle","negative","neighbour","neighbor","neighbourhood","neighborhood","neither","nerve","nervous","nest","net","network","never","new","news","newspaper","next","nice","night","nine","ninth","no","no one","noble","nobleman","noise","non-","none","nonsense","nor","normal","north","northern","nose","not","note","nothing","notice","noticeable","noun","now","nowhere","number","nurse","nut","nylon","o'clock","obedient","obey","object","obtain","occasion","ocean","odd","of","off","offence","offense","offend","offensive","offer","office","officer","official","often","oil","old","old-fashioned","on","once","one","oneself","onion","only","only just","onto","open","operate","operation","opinion","opponent","opportunity","oppose","opposite","opposition","or","orange","order","ordinary","organ","organise","organize","organization","origin","original","other","otherwise","ought","our","ours","ourselves","out","outdoor","outdoors","outer","outside","over","owe","owing","owing to","own","owner","oxygen","pack","package","packet","page","pain","painful","paint","painting","pair","palace","pale","pan","paper","parallel","parcel","parent","park","parliament","part","participle","particular","partly","partner","party","pass","passage","passenger","past","pastry","path","patience","patient","pattern","pause","pay","paid","payment","peace","peaceful","pen","pence","pencil","pepper","per","per cent","percent","perfect","perform","performance","perhaps","period","permanent","permission","permit","person","people","personal","persuade","pet","petrol","photograph","photography","phrase","physical","piano","pick","pick up","picture","piece","pig","pile","pilot","pin","pink","pipe","pity","place","plain","plan","plane","plant","plastic","plate","play","pleasant","please","pleased","pleasure","plenty","plural","pocket","poem","poet","poetry","point","pointed","poison","poisonous","pole","police","polish","polite","political","politician","politics","pool","poor","popular","popularity","population","port","position","positive","possess","possession","possibility","possible","possibly","post","pot","potato","pound","pour","powder","power","powerful","practical","practice","practise","praise","pray","prayer","precious","prefer","preparation","prepare","presence","present","preserve","president","press","pressure","pretend","pretty","prevent","previous","price","prickly","pride","priest","prince","principle","print","prison","prisoner","private","prize","probability","probably","problem","process","procession","produce","product","production","profession","profit","programme","program","progress","promise","pronounce","pronunciation","proof","proper","property","proposal","protect","protection","protective","protest","proud","prove","proven","provide","provision","provisions","public","pull","pump","punish","punishment","pupil","pure","purple","purpose","push","put","quality","quantity","quarrel","quarter","queen","question","quick","quickly","quiet","quite","rabbit","race","radio","railway","rain","raise","range","rank","rapid","rare","rat","rate","rather","raw","re-","reach","react","reaction","read","ready","real","realize","really","reason","reasonable","receive","recent","recently","recognition","recognize","record","red","reduce","reduction","refusal","refuse","regard","regular","related","relation","relationship","relative","relax","relaxing","religion","religious","remain","remark","remember","remind","remove","rent","repair","repeat","replace","reply","report","represent","representative","republic","request","respect","respectful","responsible","rest","restaurant","restrict","result","return","reward","rice","rich","rid","rid of","ride","rode","ridden","right","ring","ripe","rise","rose","risen","risk","river","road","rob","rock","rod","roll","romantic","roof","room","root","rope","rose","rough","round","row","royal","rub","rubber","rude","ruin","rule","ruler","run","ran","rush","sad","safe","safety","sail","sale","salt","same","sand","satisfaction","satisfactory","satisfy","save","say","said","scale","scatter","scene","scenery","school","science","scientific","scientist","scissors","screen","screw","sea","search","season","seat","second","secrecy","secret","secretary","see","saw","seen","seed","seem","seize","sell","sold","send","sent","sensation","sense","senseless","sensible","sensitive","sentence","separate","series","serious","servant","serve","service","set","settle","seven","seventh","several","severe","sew","sewn","sex","sexual","shade","shadow","shake","shook","shaken","shall","shame","shape","share","sharp","she","sheep","sheet","shelf","shelves","shell","shelter","shield","shine","shone","shiny","ship","shirt","shock","shocking","shoe","shoot","shot","shop","shopkeeper","shore","short","shot","should","shoulder","shout","show","shown","shut","shy","sick","side","sideways","sight","sign","signal","signature","silence","silent","silk","silly","silver","similar","similarity","simple","since","sincere","sing","sang","sung","single","singular","sink","sank","sunk","sister","sit","sat","situation","six","sixth","size","skilful","skillful","skill","skin","skirt","sky","skies","slave","sleep","slept","slide","slid","slight","slip","slippery","slope","slow","small","smell","smile","smoke","smooth","snake","snow","so","soap","social","society","sock","soft","soil","soldier","solemn","solid","solution","solve","some","somebody","somehow","someone","someplace","something","sometimes","somewhere","son","song","soon","sore","sorrow","sorry","sort","soul","sound","soup","sour","south","southern","space","spacecraft","spade","speak","spoke","spoken","spear","special","specialist","specific","speech","speed","spell","spelt","spend","spent","spin","spun","spirit","spite","splendid","split","spoil","spoilt","spoon","sport","spot","spread","spring","sprang","sprung","square","stage","stair","stamp","stand","stood","standard","star","start","state","statement","station","stay","steady","steal","stole","stolen","steam","steel","steep","stem","step","stick","stuck","sticky","stiff","still","sting","stung","stitch","stomach","stone","stop","store","storm","story","straight","strange","stranger","stream","street","strength","stretch","strict","strike","struck","string","stroke","strong","structure","struggle","student","study","stupid","style","subject","substance","subtract","succeed","success","successful","such","suck","sudden","suffer","sugar","suggest","suit","suitable","sum","summer","sun","supper","supply","support","suppose","sure","surface","surprise","surprising","surround","swallow","swear","swore","sworn","sweep","swept","sweet","swell","swollen","swim","swam","swum","swing","swung","sword","sympathetic","sympathy","system","table","tail","take","took","taken","talk","tall","taste","tax","taxi","tea","teach","taught","team","tear","tore","torn","technical","telephone","television","tell","told","temper","temperature","temple","temporary","ten","tend","tendency","tender","tennis","tense","tent","terrible","terror","test","than","thank","that","the","theatre","theater","their","theirs","them","themselves","then","there","therefore","these","they","thick","thief","thieves","thin","thing","think","thought","third","thirst","thirsty","this","thorough","those","though","thousand","thousandth","thread","threat","threaten","threatening","three","throat","through","throw","threw","thrown","thumb","thunder","thus","ticket","tidy","tie","tying","tiger","tight","time","timetable","tin","tire","tired","tiring","title","to","tobacco","today","toe","together","toilet","tomorrow","tongue","tonight","too","tool","tooth","teeth","top","total","touch","tour","tourist","towards","tower","town","toy","track","trade","traditional","traffic","train","training","translate","transparent","trap","travel","treat","treatment","tree","tremble","tribe","trick","trip","tropical","trouble","trousers","true","trunk","trust","truth","try","tries","tried","tube","tune","turn","twice","twist","two","type","typical","tyre","tire","ugly","un-","uncle","under","understand","understood","underwear","undo","undoes","undid","undone","unexpected","uniform","union","unit","unite","universal","universe","university","unless","until","unusual","up","upper","upright","upset","upside down","upstairs","urge","urgent","us","use","using","useful","useless","usual","usually","valley","valuable","value","variety","various","vary","vegetable","vehicle","verb","very","victory","view","village","violence","violent","visit","voice","vote","vowel","voyage","wages","waist","wait","waiter","wake","walk","wall","wander","want","war","warm","warmth","warn","warning","was","were","wash","waste","watch","water","wave","way","we","weak","wealth","weapon","wear","wore","worn","weather","weave","wove","woven","wedding","week","weekly","weigh","weight","welcome","well","went","west","western","wet","what","whatever","wheat","wheel","when","whenever","where","whether","which","whichever","while","whip","whisper","whistle","white","who","whoever","whole","whom","whose","why","wicked","wide","widespread","width","wife","wives","wild","will","willing","win","won","wind","wound","window","wine","wing","winter","wire","wisdom","wise","wish","with","within","without","witness","woman","women","wonder","wood","wooden","wool","woollen","woolen","word","work","world","worm","worry","worse","worship","worst","worth","worthy","would","wound","wrap","wreck","wrist","write","wrote","written","wrong","wrongdoing","yard","year","yearly","yellow","yes","yesterday","yet","you","young","your","yours","yourself","youth","zero"];
  
  try{
  for (var i=0; i<Object.keys(nlp.model().one.lexicon).length; i++) {
      if (list.indexOf(Object.keys(nlp.model().one.lexicon)[i]) == -1) {
          delete nlp.model().one.lexicon[Object.keys(nlp.model().one.lexicon)[i]];
      }
  }
  document.write(JSON.stringify(nlp.model().one.lexicon));
  }catch(e){alert(e);}
  
  //nlp.plugin(compromiseWikipedia);
  //var wiki = doc.wikipedia().json();

  function loadFile(txt, colors) {
    
    txt = txt.replace(/\</g,'≺').replace(/\>/g,'≻');
    var doc = nlp(txt);
    alert('ok');
    //doc.compute('syllables')
    doc.compute('penn');
  
    //doc.tfidf();
    //let model = doc;
    var tfidf = doc.compute('tfidf').json();
    //document.write(JSON.stringify(tfidf));
      
    //let out = "";
    //let arr = wiki.map(t=>t.text);
    
    for (var j=0; j<doc.json().length; j++) {
      let arr = doc.json()[j].terms.map(t=>[t.text, t.penn, t.tfidf]); //doc.syllables()
    
      for (var i=0; i<arr.length; i++) {
        /*if (arr[i] && arr[i]!='') {
          var p = txt.indexOf(arr[i]);
          txt = txt.substr(0, p) + "<b>"+arr[i].toUpperCase()+"</b>" + txt.substr(p+arr[i].length);
        }*/
        if (colors[arr[i][1]]) {
          arr[i][1] = colors[arr[i][1]];
        } else {
          arr[i][1] = '50';
        }
        if (arr[i][0]!='' && arr[i][0].length>1 && arr[i][0].search(/\d/)==-1) {
          var p = txt.indexOf(arr[i][0]);
          if (txt.charAt(p-1).search(/\w/)==-1 && txt.charAt(p+arr[i][0].length).search(/\w/)==-1) {
            //document.write(p+' ');
            var b = txt.substr(0,p);
            var d = txt.substr(p+arr[i][0].length);
            txt = b + "<U STYLE=\"COLOR:HSLA(0,0%,"+(100-arr[i][1])+"%,"+(0.5/arr[i][2]+0.5)+");\">" + arr[i][0].split("").join("&#847;") + "</U>" + d;
          }
        }
      }
      //out += "\n";
    }
    let el = document.getElementById('result');
    el.innerHTML = txt; //JSON.stringify(wiki, null, 2); //out;
  }
  
  window.onload = loadFile(txt, colors);
  
</script>
</body>
</html>