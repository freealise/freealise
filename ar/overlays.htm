<html>
  <head>
    <title>Overlays Within Street View</title>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
    <style>
      /*
       * Always set the map height explicitly to define the size of the div element
       * that contains the map.
       */
      #map {
        height: 100%;
      }
      
      /*
       * Optional: Makes the sample page fill the window.
       */
      html,
      body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
      
      #floating-panel {
        position: absolute;
        top: 10px;
        left: 25%;
        z-index: 5;
        background-color: #fff;
        padding: 5px;
        border: 1px solid #999;
        text-align: center;
        font-family: "Roboto", "sans-serif";
        line-height: 30px;
        padding-left: 10px;
      }
      
      #floating-panel {
        margin-left: -100px;
      }
    </style>
    <script type="module">
      let panorama;
      
      async function initMap() {
        const { Map } = await google.maps.importLibrary("maps");
        const { AdvancedMarkerElement } = await google.maps.importLibrary("marker");
        const astorPlace = { lat: 40.729884, lng: -73.990988 };
        // Set up the map
        const map = new google.maps.Map(document.getElementById("map"), {
          center: astorPlace,
          zoom: 18,
          streetViewControl: false,
        });
      
        document.getElementById("toggle").addEventListener("click", toggleStreetView);

        const marker = new AdvancedMarkerElement({
          map,
          position: { lat: 40.730031, lng: -73.991428, altitude: 2 },
        });
      
        // Set up the markers on the map
        const cafeMarker = new google.maps.Marker({
          position: { lat: 40.730031, lng: -73.991428, altitude: 5 },
          map,
          icon: "https://chart.apis.google.com/chart?chst=d_map_pin_icon&chld=cafe|FFFF00",
          title: "Cafe",
        });
        const bankMarker = new google.maps.Marker({
          position: { lat: 40.729681, lng: -73.991138, altitude: 5 },
          map,
          icon: "https://chart.apis.google.com/chart?chst=d_map_pin_icon&chld=dollar|FFFF00",
          title: "Bank",
        });
        const busMarker = new google.maps.Marker({
          position: { lat: 40.729559, lng: -73.990741, altitude: 5 },
          map,
          icon: "https://chart.apis.google.com/chart?chst=d_map_pin_icon&chld=bus|FFFF00",
          title: "Bus Stop",
        });
      
        // We get the map's default panorama and set up some defaults.
        // Note that we don't yet set it visible.
        panorama = map.getStreetView(); // TODO fix type
        panorama.setPosition(astorPlace);
        panorama.setPov(
          /** @type {google.maps.StreetViewPov} */ {
            heading: 265,
            pitch: 0,
          },
        );
      }
      
      function toggleStreetView() {
        const toggle = panorama.getVisible();
      
        if (toggle == false) {
          panorama.setVisible(true);
          map.style.filter = 'invert(1)';
        } else {
          panorama.setVisible(false);
          map.style.filter = 'none';
        }
      }
      
      window.initMap = initMap;
    </script>
  </head>
  <body>
    <div id="floating-panel">
      <input type="button" value="Toggle Street View" id="toggle" />
    </div>
    <div id="map"></div>

    <!--
      The `defer` attribute causes the callback to execute after the full HTML
      document has been parsed. For non-blocking uses, avoiding race conditions,
      and consistent behavior across browsers, consider loading using Promises.
      See https://developers.google.com/maps/documentation/javascript/load-maps-js-api
      for more information.
      -->
    <script
      src="https://maps.googleapis.com/maps/api/js?key=&callback=initMap&v=weekly"
      defer
    ></script>
  </body>
</html>
